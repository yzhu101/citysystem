# 心理地图功能说明

## 功能概述

新的心理地图功能会在玩家点击"生成日志"按钮后自动激活。系统会调用DeepSeek AI分析本次探索历史中的每一张卡片，为每张卡片生成一个最合适的emoji表情符号，分析卡片相似性生成区域名称，然后创建一个多层次可视化的心理地图。

## 主要特点

### 🧠 智能分析
- 使用DeepSeek AI分析每张探索卡片的内容
- 自动选择最符合卡片主题和情感的emoji
- 分析卡片内容相似性，生成有创意的区域名称（如"忧伤广场"、"希望之丘"等）
- 支持城市探索、观察、行动等各种场景

### 🎨 多层次可视化展示
- **底图层**：提供基础地图背景，增强空间感
- **面图层**：根据探索内容相似性生成区域，并智能命名
- **线图层**：节点按时间顺序连接，形成探索路径
- **点图层**：每个探索节点用emoji标注，直观展示探索内容
- 采用圆形布局，美观易读
- 支持点击节点查看详细内容

### 🔄 交互体验
- 鼠标悬停节点有高亮效果
- 点击节点弹出详情窗口
- 显示加载进度和状态提示
- 错误处理和重试机制

## 使用方法

### 在主游戏中使用
1. 开始城市探索游戏
2. 完成若干张探索卡片
3. 点击"生成日志"按钮
4. 等待系统生成故事和心理地图
5. 查看生成的多层次心理地图

### 演示页面
访问 `mental-map-demo.html` 可以查看功能演示：
- 包含模拟的探索历史数据
- 展示心理地图的生成过程
- 可以测试各种交互功能

## 技术实现

### 核心文件
- `js/map/mentalMap.js` - 心理地图核心类
- `city_system-v3.2.html` - 主游戏文件（已集成）
- `mental-map-demo.html` - 功能演示页面
- `assets/map/base-map.svg` - 底图文件

### API集成
- 使用DeepSeek Chat API进行内容分析
- 每张卡片单独调用API获取emoji
- 分析所有卡片内容生成区域名称
- 支持错误处理和默认值回退

### 渲染技术
- 使用SVG绘制多层次地图（底图、区域、连接线、节点）
- 响应式设计，适配不同屏幕尺寸
- CSS动画和交互效果

## 配置要求

### API密钥
需要配置有效的DeepSeek API密钥：
```javascript
window._0x8c4d = 'your-deepseek-api-key';
```

### 网络连接
- 需要稳定的网络连接
- 支持HTTPS请求到DeepSeek API
- 建议在良好网络环境下使用

## 错误处理

### 常见问题
1. **API密钥无效** - 检查密钥配置
2. **网络连接失败** - 检查网络状态
3. **内容分析失败** - 使用默认emoji (📍) 和默认区域名称
4. **底图加载失败** - 使用默认背景
5. **渲染错误** - 显示错误提示信息

### 调试信息
- 控制台输出详细的加载和分析过程
- 错误信息会显示在界面上
- 支持重试机制

## 未来扩展

### 可能的改进
- 支持更多的节点布局算法
- 添加节点分类和颜色编码
- 支持导出心理地图为图片
- 添加历史地图查看功能
- 支持自定义emoji选择
- 增强区域分析算法，支持多个区域划分

### 性能优化
- 批量API调用减少请求次数
- 本地缓存常用emoji映射
- 异步渲染提升用户体验

## 使用建议

1. **探索深度** - 建议完成3-8张卡片后生成地图，效果最佳
2. **内容质量** - 卡片内容越丰富，生成的emoji和区域名称越准确
3. **网络环境** - 在稳定网络下使用，避免生成中断
4. **浏览器兼容** - 推荐使用现代浏览器（Chrome、Firefox、Safari）
5. **底图定制** - 可以替换 `assets/map/base-map.svg` 文件自定义底图

---

*心理地图功能让城市探索更加生动有趣，通过多层次可视化直观展示你的探索轨迹、情感体验和区域特征。*